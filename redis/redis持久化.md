redis的持久化有两种方式:rdb和aof

rdb能够在指定的时间间隔保存数据的文件快照,类似于mysql的增量数据,固定时间保存一次数据。

优点:保存的是某个时间点的数据集。非常适用于数据集的备份。相对于aof而言,在恢复大数据集的时候，速度更快.rdb文件较小
缺点:因为是固定时间保存,所以当服务宕机等等原因，会造成数据丢失
操作:
    配置: save 60 10000 #60秒内至少有一万个操作时,生成文件快照
    也可以手动操作:

aof类似于mysql的bin-log,保存的是操作，而非数据，以持久化方式记录每次对服务器的写操作，当服务器重启的时候会重新执行这些
命令来恢复原始的数据。aof方式以redis协议追加保存每次写的操作到文件的末尾。
优点:当aof体积过大的时候,redis会自动的对aof文件进行重写,重写后的新的aof文件保存的恢复当前数据集所需的最小的命令集合。
    整个重写过程是安全的，redis在创建新的aof文件的过程中，会继续将命令追加到现有的aof文件里，即使重写过程中发生停机，现
    有的aof文件也不会丢失。而一旦新的aof文件创建完成，就会替换老的文件。
    aof文件有序的保存的对数据库执行的所有写入操作，这些写入操作以redis协议的格式保存，因为aof文件的内容容易被人读懂.例如
    不小心执行了删除数据的操作，就可以停止服务器，将aof文件最后的操作删除，然后再重启服务器，就可以了。
缺点:对于相同的数据集来说，Aof文件的体积通常要大于rdb的文件。因为它保存的是操作，而非数据。
操作：
    开启配置: appendonly yes
         appendfilename "appendonly.aof"
    手动执行aof的重建：bgrewriteaof #这个操作是不会打断客户端的。
    
如何选择使用哪种持久化方式：
    如果关心数据，但是仍然可以接收数分钟内数据的丢失，那么可以使用rdb。建议两者同时使用。
   
aof文件损坏了怎么办：
    可以先将旧的文件进行备份，然后使用工具
    ```
    redis-check-aof -fix
    ```
    
    进行修复,修复完成之后，可以将新文件和旧文件进行比对，
    
    ```
    redis-check-aof -diff -u
    ```
    将丢失的操作手动增加.然后再重启服务

怎样从rdb方式切换到aof

```
redis-cli config set appendonly yes
redis-cli config set save ""
```

数据备份：
    redis可以在启动的时候，对rdb文件进行拷贝，所以可以定时的对文件进行备份。
    
灾备恢复:
    