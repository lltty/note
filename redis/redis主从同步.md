redis主从同步依赖的三个主要机制:
    * 当一个master实例和一个slave实例连接正常时,master会发送一连串的命令来保持对slave的更新，以便于将自身数据集的改变复制给slave
    包括客户端的写入、key过期或被逐出等等。
    * 当master和slave之间的连接断开之后，因为网络问题、或是主从意识到连接超时，slave重新连接上master并会尝试部分重同步:这意味着它
    会尝试获取在断开期间内流失的命令流。
    * 当无法进行部分重同步时,slave会请求全量重同步。这会涉及一个更复杂的复制模式,master需要创建所有数据的快照，将它发送给slave.之后
    在数据集更改时持续发送命令流到slave。
    
redis复制功能是如何工作的？
    
    每一个master 都会有一个replication ID和一个偏移量。master将自己产生的复制流发送给slave时，发送多少个字节的数据，自身的偏移量
    就会增加多少，目的是当有新的操作修改自己的数据集时，可以以此跟新slave的状态。复制偏移量即使在没有一个slave连接到master时，也会自增。
    
    当slave连接到master时，它们使用PSYNC命令来发送它们记录的旧的master replication ID和至今为止处理的偏移量。通过这种方式，master
    能够仅发送slave所需的增加部分。但是如果master缓冲区中没有足够的命令积压缓冲记录，或者slave引用了不再知道的历史记录。则会转而进行一个
    全量重同步:在这种情况下，slave会得到一个完整的数据集副本。
    
全量同步的工作细节：
    
    master开启一个进程生成rdb文件。同时主进程缓冲所有从客户端接收到的新的写入命令。当后台保存完成之后，master将数据集文件传输给slave,
    slave将之保存在磁盘，然后加载到内存。再然后master会发送所有缓冲区的命令给slave.
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    