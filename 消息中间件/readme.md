1  如何检测消息队列是否丢失数据
在Producer端，我们可给每个发出的消息附加一个连续递增的序号，然后再Consumer端来检测这个需要的连续性。如果没有消息丢失，那么Consumer收到的需要必然是连续的。如果检测到不连续的信号，那就说明有数据丢失，还可以通过确实的序列号来确定是哪条消息，方便进一步排查原因，甚至是进行补量操作。大多数的消息队列的客户端都支持拦截器的功能，可以用拦截器的功能来实现，这样就不会入侵业务代码。待系统稳定之后可以将这部分检测的逻辑关闭或者删除。

如果是在分布式系统中实现这个检测方法：要注意几个问题：
像Kafka这样的消息队列，它是不保证在Topic上严格的顺序的，只能保证在分区上的消息是有序的，所以我们在发消息的时候必须要指定分区，并且，在每个分区单独检测消息序号的连续性。

另外如果你的系统中的Producer是多实例的，并不是能很好的协调多个Producer之间的发送顺序，所以也需要每个Producer分别生成各自的消息序列，并且附加上Producer的标识，在Consumer按照每个Producer来检测序列号的连续性。

2  kafka和RabbitMq的区别
RabbitMq是严格保证数据的，而kafka只在分区上保证顺序，在topic上是不严格保证顺序的。所以对顺序有严格的要求的就会选择RabbitMq。另外kafka在设计上大量使用了批量和异步的思想，加上为了保证性能做出的一些可靠性的牺牲，它的吞吐量非常高。另外由于批量的思想，kafka在发送消息的时候，不是实时发送的，它是先暂一批，然后再发送，如果你的业务的两级不是那么大，数据不是那么频繁，反而会发现kafka的延时会比较高。